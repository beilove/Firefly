import{_}from"./preload-helper.BlTxHScW.js";import{p as k,u as M}from"./url-utils.BYYtzi61.js";import{k as L,l as T,m as I,B as x,n as g,o as C}from"./setting-utils.Bg7Chrdw.js";import{s as P}from"./navBarConfig.Bx7Aaq8G.js";import"./zh_TW.Bl-Ke2VL.js";function b(){function n(e){if(e.hasAttribute("data-icon-initialized"))return;e.setAttribute("data-icon-initialized","true");const o=e.querySelector("[data-loading-indicator]"),t=e.querySelector("[data-icon-element]"),s=t?.getAttribute("icon");if(!o||!t)return;function a(){return t.shadowRoot&&t.shadowRoot.children.length>0?(i(),!0):!1}function i(){o.style.display="none",t.classList.remove("opacity-0"),t.classList.add("opacity-100")}function r(){o.style.display="inline-flex",t.classList.remove("opacity-100"),t.classList.add("opacity-0")}if(r(),t.addEventListener("load",()=>{i()}),t.addEventListener("error",()=>{s&&console.warn(`Failed to load icon: ${s}`)}),window.MutationObserver){const d=new MutationObserver(()=>{a()&&d.disconnect()});d.observe(t,{childList:!0,subtree:!0,attributes:!0}),setTimeout(()=>{d.disconnect(),a()},5e3)}setTimeout(()=>{a()},100)}document.querySelectorAll("[data-icon-container]").forEach(n),window.MutationObserver&&new MutationObserver(o=>{o.forEach(t=>{t.addedNodes.forEach(s=>{if(s.nodeType===Node.ELEMENT_NODE){const a=s;a.hasAttribute?.("data-icon-container")?n(a):a.querySelectorAll("[data-icon-container]").forEach(n)}})})}).observe(document.body,{childList:!0,subtree:!0})}const q=Object.freeze(Object.defineProperty({__proto__:null,initIconLoader:b},Symbol.toStringTag,{value:"Module"})),w=!!document.getElementById("banner-wrapper");function c(n,e){document.addEventListener("click",o=>{let t=document.getElementById(n);if(!t)return;let s=o.target;if(s instanceof Node){for(let a of e){let i=document.getElementById(a);if(i==s||i?.contains(s))return}t.classList.add("float-panel-closed")}})}c("display-setting",["display-setting","display-settings-switch"]);c("nav-menu-panel",["nav-menu-panel","nav-menu-switch"]);c("search-panel",["search-panel","search-bar","search-switch"]);c("wallpaper-mode-panel",["wallpaper-mode-panel","wallpaper-mode-switch"]);c("theme-mode-panel",["theme-mode-panel","scheme-switch"]);function y(){document.querySelectorAll(".katex-display:not([data-scrollbar-initialized])").forEach(e=>{if(!e.parentNode)return;const o=document.createElement("div");o.className="katex-display-container",e.parentNode.insertBefore(o,e),o.appendChild(e),o.style.cssText=`
			overflow-x: auto;
		`,e.setAttribute("data-scrollbar-initialized","true")})}function B(){requestAnimationFrame(()=>{const n=document.getElementById("banner");n&&n.classList.remove("opacity-0","scale-105");const e=document.querySelector('.block.lg\\:hidden[alt="Mobile banner image of the blog"]');e&&(e.classList.remove("opacity-0","scale-105"),e.classList.add("opacity-100"))})}const S=()=>{window.swup.hooks.on("link:click",()=>{if(document.documentElement.style.setProperty("--content-delay","0ms"),document.documentElement.classList.add("is-page-transitioning"),w){const n=document.getElementById("navbar-wrapper");if(n&&document.body.classList.contains("lg:is-home")){const e=window.innerHeight*(g/100)-88;document.documentElement.scrollTop>=e&&n.classList.add("navbar-hidden")}}}),window.swup.hooks.on("content:replace",()=>{if(l(),y(),_(async()=>{const{initIconLoader:t}=await Promise.resolve().then(()=>q);return{initIconLoader:t}},void 0).then(({initIconLoader:t})=>{t()}),document.getElementById("toc-wrapper")!==null){const t=document.querySelector("table-of-contents");t&&typeof t.init=="function"&&setTimeout(()=>{t.init()},100)}const o=document.getElementById("navbar");o&&o.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection()}),window.swup.hooks.on("visit:start",n=>{const e=document.querySelector("body"),o=k(n.to.url,M("/"));o?e.classList.add("lg:is-home"):e.classList.remove("lg:is-home");const t=document.querySelector(".banner-text-overlay");t&&(o?t.classList.remove("hidden"):t.classList.add("hidden"));const s=document.getElementById("navbar");s&&(s.setAttribute("data-is-home",o.toString()),s.getAttribute("data-transparent-mode")==="semifull"&&typeof window.initSemifullScrollDetection=="function"&&window.initSemifullScrollDetection());const a=window.innerWidth<1024;if(a){const m=document.getElementById("post-list-container");m&&(m.style.transition="none")}const i=document.getElementById("banner-wrapper"),r=document.querySelector(".absolute.w-full.z-30");a&&i&&r?o?(r.style.transition="none",i.style.display="",setTimeout(()=>{i.classList.remove("mobile-hide-banner")},100),setTimeout(()=>{r.classList.remove("mobile-main-no-banner"),setTimeout(()=>{r.style.transition=""},50)},150)):(i.classList.add("mobile-hide-banner"),setTimeout(()=>{r.classList.add("mobile-main-no-banner")},100)):!a&&i&&(i.style.display="",i.classList.remove("mobile-hide-banner"),r&&r.classList.remove("mobile-main-no-banner"));const d=document.getElementById("page-height-extend");d&&d.classList.remove("hidden");let v=document.getElementById("toc-wrapper");v&&v.classList.add("toc-not-ready")}),window.swup.hooks.on("page:view",()=>{E(),l();const n=document.getElementById("page-height-extend");n&&n.classList.remove("hidden"),window.scrollTo({top:0,behavior:"smooth"}),window.innerWidth<1024&&setTimeout(()=>{const i=document.getElementById("post-list-container");i&&(i.style.transition="")},600);const o=localStorage.getItem("theme")||P.themeColor.defaultMode||"light";let t=!1;o==="system"?t=window.matchMedia("(prefers-color-scheme: dark)").matches:t=o==="dark";const s=t?I.darkTheme:I.lightTheme;document.documentElement.getAttribute("data-theme")!==s&&document.documentElement.setAttribute("data-theme",s),setTimeout(()=>{if(document.getElementById("tcomment")){const i=new CustomEvent("firefly:page:loaded",{detail:{path:window.location.pathname,timestamp:Date.now()}});document.dispatchEvent(i),console.log("Layout: 触发 firefly:page:loaded 事件，路径:",window.location.pathname)}},300)}),window.swup.hooks.on("visit:end",n=>{setTimeout(()=>{const e=document.getElementById("page-height-extend");e&&e.classList.add("hidden");const o=document.getElementById("toc-wrapper");o&&o.classList.remove("toc-not-ready"),document.documentElement.classList.remove("is-page-transitioning")},200)})};window?.swup?.hooks?S():document.addEventListener("swup:enable",S);let u=document.getElementById("back-to-top-btn"),h=document.getElementById("toc-wrapper"),p=document.getElementById("navbar-wrapper");function H(){const n=document.documentElement.scrollTop,e=window.innerHeight*(g/100),o=[];u&&o.push(()=>{n>e?u.classList.remove("hide"):u.classList.add("hide")}),w&&h&&o.push(()=>{n>e?h.classList.remove("toc-hide"):h.classList.add("toc-hide")}),w&&p&&o.push(()=>{const s=document.body.classList.contains("lg:is-home")&&window.innerWidth>=1024?C:g,a=window.innerHeight*(s/100)-88;n>=a?p.classList.add("navbar-hidden"):p.classList.remove("navbar-hidden")}),o.length>0&&requestAnimationFrame(()=>{o.forEach(t=>t())})}let f;window.addEventListener("scroll",()=>{f&&cancelAnimationFrame(f),f=requestAnimationFrame(H)},{passive:!0});window.onresize=()=>{let n=Math.floor(window.innerHeight*(x/100));n=n-n%4,document.documentElement.style.setProperty("--banner-height-extend",`${n}px`)};document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{B(),y()}):(B(),y());const A=()=>window.location.pathname.includes("/posts/")||window.location.pathname.includes("/post/");function E(){const n=document.getElementById("main-grid");if(!n)return;const e=A(),o=n.getAttribute("data-sidebar-position")||"left",t=n.getAttribute("data-show-right-sidebar-on-post")==="true",a=o==="both"||e&&o==="left"&&t?"grid-cols-1 md:grid-cols-[17.5rem_1fr] xl:grid-cols-[17.5rem_1fr_17.5rem]":"grid-cols-1 md:grid-cols-[17.5rem_1fr]";["grid-cols-1","md:grid-cols-[17.5rem_1fr]","xl:grid-cols-[17.5rem_1fr_17.5rem]"].forEach(i=>n.classList.remove(i)),a.split(" ").forEach(i=>i&&n.classList.add(i))}function l(){const n=A();document.querySelectorAll(".widget-hide-on-post").forEach(e=>{n?e.classList.add("hidden"):e.classList.remove("hidden")}),document.querySelectorAll(".widget-hide-on-non-post").forEach(e=>{n?e.classList.remove("hidden"):e.classList.add("hidden")})}document.readyState==="loading"?document.addEventListener("DOMContentLoaded",()=>{E(),l(),L(),T(),b()}):(E(),l(),L(),T(),b());
